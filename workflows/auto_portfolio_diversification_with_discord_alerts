{
  "name": "Auto Portfolio Diversification with Discord Alerts",
  "nodes": [
    {
      "parameters": {},
      "id": "9ea4ebc0-7946-4d13-b301-f9e3959cb223",
      "name": "Daily Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -256,
        96
      ]
    },
    {
      "parameters": {
        "url": "https://app.afkcrypto.com/api/v1/wallets/balances?chain=solana",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "7fc9b552-7d54-4445-b5b0-67f48b2498aa",
      "name": "Get SOL Balance",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -32,
        0
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TMb8pmWTMkxEjk1x",
          "name": "AFK_Crypto_API_Key"
        }
      }
    },
    {
      "parameters": {
        "url": "https://app.afkcrypto.com/api/v1/wallets/balances?chain=ethereum",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "cfd04f81-1ee5-4970-9411-5e2716dd21ea",
      "name": "Get ETH Balance",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -32,
        192
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TMb8pmWTMkxEjk1x",
          "name": "AFK_Crypto_API_Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Analyze Portfolio - robust version that expects merged items (SOL + ETH responses)\n\nconst now = new Date().toISOString().split('T')[0];\n\nlet sol = 0;\nlet eth = 0;\n\n// items should contain both HTTP responses (after Merge)\nfor (const item of items) {\n  const balances = item.json?.balances || [];\n  for (const b of balances) {\n    const sym = (b.tokenSymbol || '').toString().trim().toUpperCase();\n\n    // handle common variants and be forgiving with casing\n    if (sym === 'SOL' || sym === 'WSOL' || sym.includes('SOL')) {\n      sol = Number(b.amount) || sol;\n    } else if (sym === 'ETH' || sym === 'WETH' || sym.includes('ETH')) {\n      eth = Number(b.amount) || eth;\n    }\n  }\n\n  // fallback: if API returned a single 'native' balance and the node/response suggests chain,\n  // try to use the first balance for that response:\n  if ((item.json.chain || '').toLowerCase() === 'solana' && sol === 0 && item.json.balances?.length) {\n    sol = Number(item.json.balances[0].amount) || sol;\n  }\n  if ((item.json.chain || '').toLowerCase() === 'ethereum' && eth === 0 && item.json.balances?.length) {\n    eth = Number(item.json.balances[0].amount) || eth;\n  }\n}\n\n// final safety: if still both zero, produce a helpful message instead of an empty string\nconst total = (Number(sol) || 0) + (Number(eth) || 0);\nconst solPct = total > 0 ? (sol / total) * 100 : 0;\nconst ethPct = total > 0 ? (eth / total) * 100 : 0;\n\nlet message = `ðŸ“Š Portfolio Diversification Report (${now})\\n\\n`;\nmessage += `SOL: ${sol} (${solPct.toFixed(1)}%)\\n`;\nmessage += `ETH: ${eth} (${ethPct.toFixed(1)}%)\\n\\n`;\n\nconst threshold = 70;\nif (total === 0) {\n  message = `âš ï¸ Could not read balances from AFK API. Please check the Get SOL/ETH Balance nodes' outputs.`;\n} else if (solPct > threshold) {\n  message += `âš ï¸ SOL is dominating your portfolio (> ${threshold}%). Consider rebalancing into ETH.`;\n} else if (ethPct > threshold) {\n  message += `âš ï¸ ETH is dominating your portfolio (> ${threshold}%). Consider rebalancing into SOL.`;\n} else {\n  message += `âœ… Portfolio is well-balanced.`;\n}\n\nreturn [{ json: { message } }];"
      },
      "id": "be0c1e01-501b-4ed8-9cd4-7854fc49e6fc",
      "name": "Analyze Portfolio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        96
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        192,
        96
      ],
      "id": "5b2bd1cf-c73c-4183-9aa1-b3e7b5671a8b",
      "name": "Merge"
    },
    {
      "parameters": {
        "resource": "message",
        "guildId": {
          "__rl": true,
          "value": "1280652666577354803",
          "mode": "list",
          "cachedResultName": "Renz's server",
          "cachedResultUrl": "https://discord.com/channels/1280652666577354803"
        },
        "channelId": {
          "__rl": true,
          "value": "1280652667408089210",
          "mode": "list",
          "cachedResultName": "general",
          "cachedResultUrl": "https://discord.com/channels/1280652666577354803/1280652667408089210"
        },
        "content": "={{ $json.message }}",
        "options": {}
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        640,
        96
      ],
      "id": "b1c91287-b360-4ddc-9662-dd06dcee21ff",
      "name": "Send a message",
      "webhookId": "15463cba-4130-4773-8c14-ee8ee07eec66",
      "credentials": {
        "discordBotApi": {
          "id": "9ivVgYWgpq4MNHqd",
          "name": "Discord Bot Token"
        }
      }
    },
    {
      "parameters": {
        "content": "## Try It Out!\n\nThis workflow automatically monitors your Solana (SOL) and Ethereum (ETH) wallet balances once per day using the AFK Crypto API. It calculates how much of your total holdings are in each asset and determines if your portfolio is balanced.\n\nIf one asset exceeds 70% of your total holdings, it instantly sends a Discord alert suggesting a rebalance. If your allocation is healthy, it confirms your portfolio is balanced. If no balances are returned, youâ€™ll get an alert to check your setup.\n\nUse this to maintain portfolio diversification and stay ahead of riskâ€”without logging into any dashboard.\n\nHow It Works\n\nDaily Trigger â€“ The workflow automatically runs once every day at your chosen time.\n\nGet SOL Balance â€“ Fetches your Solana wallet balance from the AFK Crypto API.\n\nGet ETH Balance â€“ Fetches your Ethereum wallet balance from the AFK Crypto API.\n\nMerge â€“ Combines both responses into a single dataset for analysis.\n\nAnalyze Portfolio â€“\n\nCalculates the percentage of SOL vs ETH holdings.\n\nDetects if your portfolio is overexposed to one asset.\n\nBuilds a summary report and message.\n\nSend Discord Message â€“ Sends the analysis result to your selected Discord channel, including any rebalance recommendations.\n\nHow to Use\n\nImport this workflow into your n8n instance.\n\nConfigure your AFK Crypto API Key under Credentials â†’ HTTP Header Auth.\n\nSet up your Discord Bot Token or Webhook URL under Credentials â†’ Discord Bot API.\n\nUpdate the Guild ID and Channel ID in the Send a message node to your preferred Discord channel.\n\nOptionally adjust the rebalance threshold in the Code node (default: 70%).\n\nActivate the workflow. It will automatically check your wallet every day and send the results to Discord.\n\n(Optional) Extend This Workflow\n\nMulti-chain support: Add BSC, Polygon, or Avalanche wallets for broader portfolio tracking.\n\nCustom alerts: Create tiered alerts for 60%, 80%, or 90% dominance thresholds.\n\nHistorical logging: Send each daily report to Google Sheets, Airtable, or Notion for performance tracking.\n\nAuto-rebalance: Integrate a rebalance execution workflow via AFK Crypto smart automation.\n\nRequirements\n\nAFK Crypto Wallet + API Key\n\nDiscord Bot Token or Webhook URL\n\nn8n Instance with Internet Access\n\nAFK APIs Used:\n\nhttps://api.afkcrypto.com/v1/wallets/balances?chain=solana\n\nhttps://api.afkcrypto.com/v1/wallets/balances?chain=ethereum\n\nSummary\nWorkflow Name\tAuto Portfolio Diversification with Discord Alerts\nPurpose\tAutomatically monitor SOL and ETH wallet diversification\nTrigger\tDaily (Cron)\nNotifications\tDiscord Alerts\nAPI Source\tAFK Crypto\nAutomation Type\tPortfolio Monitoring & Risk Management",
        "height": 1520,
        "width": 736
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1072,
        -656
      ],
      "typeVersion": 1,
      "id": "6eaecb30-2f64-4c1d-a5dc-d7ffac919685",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "Daily Trigger": {
      "main": [
        [
          {
            "node": "Get SOL Balance",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get ETH Balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get SOL Balance": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get ETH Balance": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Analyze Portfolio": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Analyze Portfolio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1caa6497-eea6-4e77-93a2-a08842ca73c8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c4eae34af81eeff658410c97c38d8a485e4c73ba5cea5b25eef189aa5e5a73b9"
  },
  "id": "stxb6pvhWUgpmdu1",
  "tags": []
}