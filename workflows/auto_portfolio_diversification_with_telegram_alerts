{
  "name": "Auto Portfolio Diversification with Telegram Alerts",
  "nodes": [
    {
      "parameters": {},
      "id": "76fc5706-b890-4b3d-a118-2eeb8ddc99b0",
      "name": "Daily Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -256,
        96
      ]
    },
    {
      "parameters": {
        "url": "https://app.afkcrypto.com/api/v1/wallets/balances?chain=solana",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "180eb640-cac2-49c8-a912-2a99e329f076",
      "name": "Get SOL Balance",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -32,
        0
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TMb8pmWTMkxEjk1x",
          "name": "AFK_Crypto_API_Key"
        }
      }
    },
    {
      "parameters": {
        "url": "https://app.afkcrypto.com/api/v1/wallets/balances?chain=ethereum",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "df291c01-1133-4500-96c8-e0780dfd2fcd",
      "name": "Get ETH Balance",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -32,
        192
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "TMb8pmWTMkxEjk1x",
          "name": "AFK_Crypto_API_Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Analyze Portfolio - robust version that expects merged items (SOL + ETH responses)\n\nconst now = new Date().toISOString().split('T')[0];\n\nlet sol = 0;\nlet eth = 0;\n\n// items should contain both HTTP responses (after Merge)\nfor (const item of items) {\n  const balances = item.json?.balances || [];\n  for (const b of balances) {\n    const sym = (b.tokenSymbol || '').toString().trim().toUpperCase();\n\n    // handle common variants and be forgiving with casing\n    if (sym === 'SOL' || sym === 'WSOL' || sym.includes('SOL')) {\n      sol = Number(b.amount) || sol;\n    } else if (sym === 'ETH' || sym === 'WETH' || sym.includes('ETH')) {\n      eth = Number(b.amount) || eth;\n    }\n  }\n\n  // fallback: if API returned a single 'native' balance and the node/response suggests chain,\n  // try to use the first balance for that response:\n  if ((item.json.chain || '').toLowerCase() === 'solana' && sol === 0 && item.json.balances?.length) {\n    sol = Number(item.json.balances[0].amount) || sol;\n  }\n  if ((item.json.chain || '').toLowerCase() === 'ethereum' && eth === 0 && item.json.balances?.length) {\n    eth = Number(item.json.balances[0].amount) || eth;\n  }\n}\n\n// final safety: if still both zero, produce a helpful message instead of an empty string\nconst total = (Number(sol) || 0) + (Number(eth) || 0);\nconst solPct = total > 0 ? (sol / total) * 100 : 0;\nconst ethPct = total > 0 ? (eth / total) * 100 : 0;\n\nlet message = `📊 Portfolio Diversification Report (${now})\\n\\n`;\nmessage += `SOL: ${sol} (${solPct.toFixed(1)}%)\\n`;\nmessage += `ETH: ${eth} (${ethPct.toFixed(1)}%)\\n\\n`;\n\nconst threshold = 70;\nif (total === 0) {\n  message = `⚠️ Could not read balances from AFK API. Please check the Get SOL/ETH Balance nodes' outputs.`;\n} else if (solPct > threshold) {\n  message += `⚠️ SOL is dominating your portfolio (> ${threshold}%). Consider rebalancing into ETH.`;\n} else if (ethPct > threshold) {\n  message += `⚠️ ETH is dominating your portfolio (> ${threshold}%). Consider rebalancing into SOL.`;\n} else {\n  message += `✅ Portfolio is well-balanced.`;\n}\n\nreturn [{ json: { message } }];"
      },
      "id": "a808ec55-040b-4408-82b2-711a19bb8d18",
      "name": "Analyze Portfolio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        96
      ]
    },
    {
      "parameters": {
        "chatId": "CHAT_ID",
        "text": "={{ $json.message }}",
        "additionalFields": {}
      },
      "id": "9d585949-8ae7-41a5-8ea1-ecad6c7b0569",
      "name": "Send Telegram Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        640,
        96
      ],
      "webhookId": "027f5654-bf66-4ac4-8d4f-d983f871c6e3",
      "credentials": {
        "telegramApi": {
          "id": "P5PVPL3oGa7q3l59",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        192,
        96
      ],
      "id": "e13efba3-9e2c-484a-bfc9-3be936a224d1",
      "name": "Merge"
    },
    {
      "parameters": {
        "content": "## Try It Out!\n\nThis workflow automatically checks your Solana (SOL) and Ethereum (ETH) wallet balances once per day using the AFK Crypto API. It calculates how much of your total holdings are in each asset and determines whether your portfolio is balanced.\n\nIf one asset exceeds 70% of your portfolio, it sends a Telegram alert recommending a rebalance. If your holdings are balanced, you’ll receive a confirmation message. If the API fails to return data, the workflow immediately notifies you to check your setup.\n\nUse this to maintain portfolio diversification and prevent overexposure without manually checking dashboards.\n\nHow It Works\n\nDaily Trigger – The workflow starts automatically every day at a set time.\n\nGet SOL Balance – Fetches your Solana wallet balance using the AFK Crypto API.\n\nGet ETH Balance – Fetches your Ethereum wallet balance using the AFK Crypto API.\n\nMerge – Combines the SOL and ETH API responses into a single dataset.\n\nAnalyze Portfolio –\n\nCalculates the ratio of SOL vs ETH in your holdings.\n\nDetermines whether the portfolio is balanced or overexposed.\n\nGenerates a concise diversification report.\n\nSend Telegram Alert – Sends the analysis result directly to your Telegram chat, including actionable insights.\n\nHow to Use\n\nImport this workflow into your n8n instance.\n\nAdd your AFK Crypto API Key and Telegram Bot credentials under Credentials → HTTP Header Auth and Telegram API.\n\nReplace CHAT_ID in the Send Telegram Alert node with your actual Telegram Chat ID.\n\nOptionally adjust the rebalance threshold in the Code node (default: 70%).\n\nActivate the workflow — it will run once daily and deliver a detailed diversification report automatically.\n\n(Optional) Extend This Workflow\n\nAdd more chains: Include APIs for other networks (e.g., BSC, Polygon) to track a broader portfolio.\n\nAuto-rebalance: Integrate with a smart contract or AFK automation endpoint to execute rebalancing directly.\n\nHistorical tracking: Log each report to Google Sheets or Airtable for long-term portfolio trend analysis.\n\nVisual insights: Connect to a charting node (e.g., using Chart.js or Notion dashboards) for daily visual summaries.\n\nRequirements\n\nAFK Crypto account and API Key\n\nTelegram Bot API Token and Chat ID\n\nn8n instance with internet access\n\nAFK APIs Used:\n\nhttps://api.afkcrypto.com/v1/wallets/balances?chain=solana\n\nhttps://api.afkcrypto.com/v1/wallets/balances?chain=ethereum\n\nSummary\nField\tDetails\nWorkflow Name\tAuto Portfolio Diversification with Telegram Alerts\nPurpose\tAutomatically monitor SOL and ETH wallet diversification\nTrigger\tDaily (Cron)\nNotifications\tTelegram Alerts\nAPI Source\tAFK Crypto\nAutomation Type\tPortfolio Monitoring & Risk Management",
        "height": 1504,
        "width": 800
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1152,
        -608
      ],
      "typeVersion": 1,
      "id": "f95130c7-e17a-4a1e-97a7-feed2ac9f5b9",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "Daily Trigger": {
      "main": [
        [
          {
            "node": "Get SOL Balance",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get ETH Balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get SOL Balance": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get ETH Balance": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Analyze Portfolio": {
      "main": [
        [
          {
            "node": "Send Telegram Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Analyze Portfolio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "9a17dbe6-c82d-423f-b59c-8fe0f32e5d17",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c4eae34af81eeff658410c97c38d8a485e4c73ba5cea5b25eef189aa5e5a73b9"
  },
  "id": "921w4QQAhQC28HTt",
  "tags": []
}